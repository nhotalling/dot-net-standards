# Code Coverage

Code coverage itself is not a goal. The goal is to have well-tested code.
Code coverage is one tool that can be used to ensure you have well-tested
code. You SHOULD use unit tests and you SHOULD rely on continuous integration to
produce code coverage reports for  to validate both that your unit tests
pass and that you have adequate testing to demonstrate well-tested code.
We recommend at least 80% code coverage on your testable code. See below 
for additional details.

You MUST automate the collection of code coverage metrics for projects that match one or more of the following:

* Are product focused
* Will have a project development time of 1 year
* Has a total project development budget of 2000 hours

Other project types do not require code coverage to be run during continuous integration. Additionally,
projects that do match one or more of the above can have exemptions where:

* Project does not use continuous integration
* It is difficult or impossible to run code analysis (mobile applications that
  require tests to be run on actual devices or emulators)
* Project budget does not allow for code coverage

## Exempt Code

Code is considered exempt from code coverage analysis if:

* It is dynamically generated
* It is a simple, predictable, and proven pattern that resembles boilerplate.
  (Consider, could it could be generated by a T4 template if one were so
  inclined?)
* Is by necessity tied to untestable framework

You SHOULD use `ExcludeFromCodeCoverageAttribute` when collecting code coverage metrics
on code that is exempt to avoid false positives (i.e. low code coverage due to the
presence of exempt code in the metrics). You MUST NOT abuse `ExcludeFromCodeCoverageAttribute`
to game the system. It is better to fail the metric than to pretend to have well-tested
code.

## Tool Sets

For code coverage, OpenCover and ReportGenerator or native Visual Studio/.NET Core tooling
SHOULD be used. When generating
reports, consider publishing them to a location such that they can be accessible

[https://github.com/OpenCover/opencover](https://github.com/OpenCover/opencover)

[https://github.com/danielpalme/ReportGenerator](https://github.com/danielpalme/ReportGenerator)

Use the following sample code to get started:

```sh run-coverage.bat
if not exist coverage mkdir ..\coverage

..\packages\OpenCover.4.6.166\tools\OpenCover.Console.exe^
 -register:user^
 -target:"..\packages\NUnit.Runners.2.6.4\tools\nunit-console.exe"^
 -targetargs:"..\ClientNme.nunit -xml=..\TestResult.xml /noshadow"^
 -filter:"+[ClientName*]*  -[*.Tests*]*"^
 -output:..\coverage.xml

..\packages\ReportGenerator.2.3.2.0\tools\reportgenerator.exe -reports:..\coverage.xml -targetdir:..\coverage
```

When running continuous integration in Azure DevOps you SHOULD use the built-in code coverage tooling
available in the DevOps tooling OR in .NET Core to perform code coverage analysis.